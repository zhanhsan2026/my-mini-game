<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ´›å®è’¸è‚‰åˆ¶ä½œä½“éªŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html, body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #FFE5B4, #FFB6C1);
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: none;
        }

        .game-container.active {
            display: block;
        }

        #quizScreen {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            height: 100vh;
        }

        .header {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .game-title {
            font-size: 22px;
            color: #FF6B6B;
            font-weight: bold;
        }

        .operation-tip {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            color: #FF6B6B;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            white-space: nowrap;
            max-width: 95%;
            text-align: center;
            pointer-events: none;
        }

        .materials-area {
            position: absolute;
            top: 140px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 10px;
            width: 95%;
            justify-content: center;
            z-index: 100;
        }

        .material-card {
            width: 70px;
            height: 85px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: transform 0.1s;
            touch-action: none;
        }

        .material-card:active {
            transform: scale(0.95);
        }

        .material-card.dragging {
            opacity: 0.5;
        }

        .material-card.used {
            opacity: 0.3;
            pointer-events: none;
        }

        .material-emoji {
            font-size: 28px;
            margin-bottom: 3px;
            pointer-events: none;
        }

        .material-name {
            font-size: 10px;
            color: #666;
            pointer-events: none;
        }

        .drag-clone {
            position: fixed;
            z-index: 1000;
            pointer-events: none;
            opacity: 0.9;
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 70px;
            height: 85px;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .cooking-area {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 50;
            align-items: flex-end;
        }

        .cooking-area > div {
            position: relative;
            text-align: center;
        }

        .cooking-area .label {
            font-size: 12px;
            color: #333;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .pot {
            width: 100px;
            height: 80px;
            background: #E0E0E0;
            border-radius: 0 0 50px 50px;
            border: 3px solid #9E9E9E;
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 5px;
        }

        .pot:active {
            transform: scale(0.95);
        }

        .basin {
            width: 80px;
            height: 60px;
            background: #FFF8E1;
            border-radius: 0 0 40px 40px;
            border: 2px solid #FFD54F;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 5px;
        }

        .drop-zone {
            width: 90%;
            height: 85%;
            border: 2px dashed transparent;
            border-radius: 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            padding: 5px;
            transition: all 0.2s;
            pointer-events: none;
        }

        .drop-zone.drag-over {
            border-color: #FF6B6B;
            background: rgba(255,107,107,0.1);
        }

        .fire {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
        }

        .action-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            display: none;
            cursor: pointer;
            z-index: 200;
            font-weight: bold;
            touch-action: manipulation;
        }

        .action-btn:active {
            transform: translateX(-50%) scale(0.95);
            background: #FF5252;
        }

        .action-btn.show {
            display: block;
        }

        .quiz-container {
            padding: 20px 15px 100px 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .quiz-question {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
            line-height: 1.4;
            font-size: 15px;
        }

        .quiz-option {
            padding: 12px;
            margin: 8px 0;
            background: #F5F5F5;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            touch-action: manipulation;
        }

        .quiz-option:active {
            transform: scale(0.98);
            background: #FFEBEE;
        }

        .quiz-option.selected {
            background: #FF6B6B;
            color: white;
        }

        .quiz-option.correct-answer {
            background: #4CAF50 !important;
            color: white !important;
        }

        .quiz-option.wrong-answer {
            background: #f44336 !important;
            color: white !important;
        }

        .reward-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .reward-card {
            background: white;
            padding: 30px 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 90%;
        }

        .btn-restart {
            padding: 12px 30px;
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            font-weight: bold;
            touch-action: manipulation;
        }

        .btn-restart:active {
            transform: scale(0.95);
            background: #FF5252;
        }

        .mixing-area {
            display: none;
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 150;
        }

        .mixing-area.show {
            display: block;
        }

        .mixed-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 180px;
        }

        .quiz-result {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 0 auto 20px auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
            max-width: 600px;
        }

        .quiz-result.show {
            display: block;
        }

        .result-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #FF6B6B;
        }

        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            background: #F5F5F5;
            border-radius: 8px;
            font-size: 14px;
        }

        .result-item.correct {
            border-left: 4px solid #4CAF50;
        }

        .result-item.wrong {
            border-left: 4px solid #f44336;
        }

        .result-question {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .result-answer {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .result-correct-answer {
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- åˆ¶ä½œç•Œé¢ -->
    <div id="cookingScreen" class="game-container active">
        <div class="header">
            <div class="game-title">æ´›å®è’¸è‚‰åˆ¶ä½œä½“éªŒ</div>
        </div>
        <div class="operation-tip" id="operationTip">æ‹–æ‹½æ°´å’Œæ²¹åˆ°é”…é‡Œï¼Œç„¶åæ”¾çº¢è–¯ç²‰æ¡</div>
        
        <div class="materials-area" id="materialsArea">
            <div class="material-card" data-material="æ°´" data-emoji="ğŸ’§">
                <div class="material-emoji">ğŸ’§</div>
                <div class="material-name">æ°´</div>
            </div>
            <div class="material-card" data-material="é£Ÿç”¨æ²¹" data-emoji="ğŸ¶">
                <div class="material-emoji">ğŸ¶</div>
                <div class="material-name">é£Ÿç”¨æ²¹</div>
            </div>
            <div class="material-card" data-material="çº¢è–¯ç²‰æ¡" data-emoji="ğŸœ">
                <div class="material-emoji">ğŸœ</div>
                <div class="material-name">çº¢è–¯ç²‰æ¡</div>
            </div>
            
            <div class="material-card" data-material="çŒªè‚‰" data-emoji="ğŸ·" style="display:none;">
                <div class="material-emoji">ğŸ·</div>
                <div class="material-name">çŒªè‚‰</div>
            </div>
            <div class="material-card" data-material="ç‰›è‚‰" data-emoji="ğŸ„" style="display:none;">
                <div class="material-emoji">ğŸ„</div>
                <div class="material-name">ç‰›è‚‰</div>
            </div>
            <div class="material-card" data-material="ç¾Šè‚‰" data-emoji="ğŸ‘" style="display:none;">
                <div class="material-emoji">ğŸ‘</div>
                <div class="material-name">ç¾Šè‚‰</div>
            </div>
            
            <div class="material-card" data-material="ç‰ç±³é¢" data-emoji="ğŸŒ½" style="display:none;">
                <div class="material-emoji">ğŸŒ½</div>
                <div class="material-name">ç‰ç±³é¢</div>
            </div>
            <div class="material-card" data-material="ç™½é¢" data-emoji="ğŸš" style="display:none;">
                <div class="material-emoji">ğŸš</div>
                <div class="material-name">ç™½é¢</div>
            </div>
        </div>

        <div class="cooking-area">
            <div>
                <div class="label">å·¦ç›†</div>
                <div class="basin" data-zone="leftZone">
                    <div class="drop-zone" id="leftZone"></div>
                </div>
            </div>
            
            <div>
                <div class="label">é”…</div>
                <div class="pot" id="pot">
                    <div class="drop-zone" id="potZone"></div>
                    <span class="fire">ğŸ”¥</span>
                </div>
            </div>
            
            <div>
                <div class="label">å³ç›†</div>
                <div class="basin" data-zone="rightZone">
                    <div class="drop-zone" id="rightZone"></div>
                </div>
            </div>
        </div>

        <div class="mixing-area" id="mixingArea">
            <div class="mixed-content" id="mixedContent">
                <div style="font-size: 40px; margin-bottom: 10px;">ğŸ¥£</div>
                <div>æ··åˆæ…æ‹Œä¸­...</div>
            </div>
        </div>

        <button class="action-btn" id="mixBtn">æ··åˆæ…æ‹Œ</button>
        <button class="action-btn" id="steamBtn">å¼€å§‹è’¸åˆ¶</button>
    </div>

    <!-- ç­”é¢˜ç•Œé¢ -->
    <div id="quizScreen" class="game-container">
        <div class="quiz-container" id="quizContainer">
            <div class="quiz-question" data-question="1">
                <div class="question-title">1. åˆ¤æ–­æ­£è¯¯ï¼šåˆ¶ä½œè’¸è‚‰æ—¶ï¼Œè…Œåˆ¶è‚‰ç‰‡å’Œç²‰æ¡çš„æ ¸å¿ƒè°ƒæ–™æœ‰ç›ã€åä¸‰é¦™ã€è€æŠ½ã€ç”œé¢é…±ã€èšæ²¹</div>
                <div class="quiz-option" data-answer="A" data-index="1" data-correct="true">A. æ­£ç¡®</div>
                <div class="quiz-option" data-answer="B" data-index="1" data-correct="false">B. é”™è¯¯</div>
            </div>

            <div class="quiz-question" data-question="2">
                <div class="question-title">2. æ´›å®è’¸è‚‰çš„æ ¸å¿ƒçƒ¹é¥ªæ–¹å¼æ˜¯ï¼Ÿ</div>
                <div class="quiz-option" data-answer="A" data-index="2" data-correct="false">A. ç‚¸</div>
                <div class="quiz-option" data-answer="B" data-index="2" data-correct="true">B. è’¸</div>
                <div class="quiz-option" data-answer="C" data-index="2" data-correct="false">C. ç‚–</div>
                <div class="quiz-option" data-answer="D" data-index="2" data-correct="false">D. ç…®</div>
            </div>

            <div class="quiz-question" data-question="3">
                <div class="question-title">3. æ´›å®è’¸è‚‰è¢«åˆ—å…¥éç‰©è´¨æ–‡åŒ–é—äº§ï¼Œæœ€ä¸»è¦çš„ä»·å€¼åœ¨äºï¼Ÿ</div>
                <div class="quiz-option" data-answer="A" data-index="3" data-correct="false">A. é£Ÿææ˜‚è´µ</div>
                <div class="quiz-option" data-answer="B" data-index="3" data-correct="false">B. åˆ¶ä½œå¤æ‚</div>
                <div class="quiz-option" data-answer="C" data-index="3" data-correct="true">C. æ‰¿è½½äº†åœ°æ–¹çš„å†å²è®°å¿†ã€ç”Ÿæ´»æ™ºæ…§ä¸å®¶æ—æƒ…æ„Ÿ</div>
                <div class="quiz-option" data-answer="D" data-index="3" data-correct="false">D. åªæœ‰å°‘æ•°äººä¼šåš</div>
            </div>

            <button class="action-btn" id="submitQuiz" style="display: block; position: relative; bottom: auto; transform: none; margin: 20px auto;">æäº¤ç­”æ¡ˆ</button>
        </div>

        <div class="quiz-result" id="quizResult">
            <div class="result-title">ğŸ“‹ ç­”é¢˜è§£æ</div>
            <div id="resultContent"></div>
            <button class="btn-restart" id="nextToReward" style="margin: 20px auto; display: block;">æŸ¥çœ‹å¥–åŠ±</button>
        </div>
    </div>

    <!-- å¥–åŠ±ç•Œé¢ -->
    <div id="rewardScreen" class="game-container">
        <div class="reward-container">
            <div class="reward-card">
                <div style="font-size: 60px; margin-bottom: 20px;">ğŸ‰</div>
                <h2>åˆ¶ä½œå®Œæˆï¼</h2>
                <p style="margin: 20px 0; line-height: 1.8; color: #666; font-size: 14px;">
                    å¤æ³•æ–°"è’¸"ï¼ŒåŒ å¿ƒä¼ æ‰¿ã€‚<br>
                    æ„¿è¿™ç¼•éé—çš„é¦™æ°”ï¼Œ<br>
                    ä¼´æ‚¨çš„äº‹ä¸šä¸ç”Ÿæ´»ï¼Œè’¸è’¸æ—¥ä¸Šï¼Œçƒ­æ°”è…¾è…¾!
                </p>
                <button class="btn-restart" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let currentStep = 1;
        let potContents = [];
        let leftBasinContents = [];
        let rightBasinContents = [];
        let quizAnswers = {};
        let selectedMeat = null;
        
        // æ‹–åŠ¨çŠ¶æ€
        let dragState = {
            isDragging: false,
            draggedElement: null,
            cloneElement: null,
            currentX: 0,
            currentY: 0
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initDragAndDrop();
            initGameLogic();
        });

        // åˆå§‹åŒ–æ‹–æ”¾ - åŒæ—¶æ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸
        function initDragAndDrop() {
            const cards = document.querySelectorAll('.material-card');
            
            cards.forEach(card => {
                // é¼ æ ‡äº‹ä»¶
                card.addEventListener('mousedown', handleDragStart);
                // è§¦æ‘¸äº‹ä»¶
                card.addEventListener('touchstart', handleDragStart, {passive: false});
            });
            
            // å…¨å±€ç§»åŠ¨å’Œç»“æŸäº‹ä»¶
            window.addEventListener('mousemove', handleDragMove);
            window.addEventListener('touchmove', handleDragMove, {passive: false});
            window.addEventListener('mouseup', handleDragEnd);
            window.addEventListener('touchend', handleDragEnd);
            window.addEventListener('touchcancel', handleDragEnd);
        }

        function handleDragStart(e) {
            const card = e.target.closest('.material-card');
            if (!card || card.classList.contains('used')) return;
            
            const isTouch = e.type === 'touchstart';
            
            // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆé˜²æ­¢æ»šåŠ¨ã€ç¼©æ”¾ã€é€‰ä¸­æ–‡æœ¬ï¼‰
            e.preventDefault();
            
            const clientX = isTouch ? e.touches[0].clientX : e.clientX;
            const clientY = isTouch ? e.touches[0].clientY : e.clientY;
            
            dragState.isDragging = true;
            dragState.draggedElement = card;
            dragState.currentX = clientX;
            dragState.currentY = clientY;
            
            // åˆ›å»ºå…‹éš†å…ƒç´ 
            const rect = card.getBoundingClientRect();
            const clone = card.cloneNode(true);
            clone.classList.add('drag-clone');
            clone.style.left = rect.left + 'px';
            clone.style.top = rect.top + 'px';
            
            document.body.appendChild(clone);
            dragState.cloneElement = clone;
            
            card.classList.add('dragging');
            
            // éœ‡åŠ¨åé¦ˆ
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }

        function handleDragMove(e) {
            if (!dragState.isDragging) return;
            
            const isTouch = e.type === 'touchmove';
            
            // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆé˜²æ­¢æ»šåŠ¨ï¼‰
            e.preventDefault();
            
            const clientX = isTouch ? e.touches[0].clientX : e.clientX;
            const clientY = isTouch ? e.touches[0].clientY : e.clientY;
            
            dragState.currentX = clientX;
            dragState.currentY = clientY;
            
            const clone = dragState.cloneElement;
            if (clone) {
                clone.style.left = (clientX - clone.offsetWidth / 2) + 'px';
                clone.style.top = (clientY - clone.offsetHeight / 2) + 'px';
            }
            
            checkHoverZone(clientX, clientY);
        }

        function handleDragEnd(e) {
            if (!dragState.isDragging) return;
            
            const card = dragState.draggedElement;
            const clone = dragState.cloneElement;
            const material = card.dataset.material;
            const emoji = card.dataset.emoji;
            
            // æ£€æµ‹æ”¾ç½®ä½ç½®
            const dropZone = getDropZone(dragState.currentX, dragState.currentY);
            
            if (dropZone) {
                handleDrop(material, emoji, dropZone);
                
                if (navigator.vibrate) {
                    navigator.vibrate([50, 50]);
                }
            }
            
            // æ¸…ç†
            if (clone) clone.remove();
            if (card) card.classList.remove('dragging');
            
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            dragState = {
                isDragging: false,
                draggedElement: null,
                cloneElement: null,
                currentX: 0,
                currentY: 0
            };
        }

        function checkHoverZone(x, y) {
            const zones = ['potZone', 'leftZone', 'rightZone'];
            
            zones.forEach(zoneId => {
                const zone = document.getElementById(zoneId);
                const rect = zone.getBoundingClientRect();
                
                if (x >= rect.left && x <= rect.right && 
                    y >= rect.top && y <= rect.bottom) {
                    zone.classList.add('drag-over');
                } else {
                    zone.classList.remove('drag-over');
                }
            });
        }

        function getDropZone(x, y) {
            const zones = ['potZone', 'leftZone', 'rightZone'];
            
            for (let zoneId of zones) {
                const zone = document.getElementById(zoneId);
                const rect = zone.getBoundingClientRect();
                const padding = 20;
                
                if (x >= rect.left - padding && x <= rect.right + padding && 
                    y >= rect.top - padding && y <= rect.bottom + padding) {
                    return zoneId;
                }
            }
            return null;
        }

        function handleDrop(material, emoji, zoneId) {
            if (currentStep === 1 && zoneId === 'potZone' && 
                ['æ°´', 'é£Ÿç”¨æ²¹', 'çº¢è–¯ç²‰æ¡'].includes(material) && !potContents.includes(material)) {
                potContents.push(material);
                markMaterialUsed(material);
                addEmojiToZone(zoneId, emoji);
                checkStep1Complete();
            }
            else if (currentStep === 2 && zoneId === 'rightZone' && 
                     ['çŒªè‚‰', 'ç‰›è‚‰', 'ç¾Šè‚‰'].includes(material) && !selectedMeat) {
                selectedMeat = material;
                rightBasinContents.push(material);
                markMaterialUsed(material);
                addEmojiToZone(zoneId, emoji);
                ['çŒªè‚‰', 'ç‰›è‚‰', 'ç¾Šè‚‰'].forEach(m => {
                    if (m !== material) {
                        document.querySelector(`[data-material="${m}"]`).classList.add('used');
                    }
                });
                ['ç‰ç±³é¢', 'ç™½é¢'].forEach(m => {
                    document.querySelector(`[data-material="${m}"]`).style.display = 'flex';
                });
                currentStep = 3;
                updateTip('æ‹–æ‹½ç‰ç±³é¢å’Œç™½é¢åˆ°å³ç›†');
            }
            else if (currentStep === 3 && zoneId === 'rightZone' && 
                     ['ç‰ç±³é¢', 'ç™½é¢'].includes(material) && !rightBasinContents.includes(material)) {
                rightBasinContents.push(material);
                markMaterialUsed(material);
                addEmojiToZone(zoneId, emoji);
                if (rightBasinContents.length === 3) {
                    currentStep = 4;
                    updateTip('ä¸¤ä¸ªç›†çš„ææ–™å‡†å¤‡å®Œæˆï¼ç‚¹å‡»æ··åˆæŒ‰é’®ï¼');
                    document.getElementById('mixBtn').style.display = 'block';
                }
            }
        }

        function markMaterialUsed(material) {
            const card = document.querySelector(`[data-material="${material}"]`);
            if (card) card.classList.add('used');
        }

        function addEmojiToZone(zoneId, emoji) {
            const div = document.createElement('div');
            div.textContent = emoji;
            div.style.fontSize = '20px';
            div.style.lineHeight = '1';
            document.getElementById(zoneId).appendChild(div);
        }

        function updateTip(text) {
            document.getElementById('operationTip').textContent = text;
        }

        function checkStep1Complete() {
            if (potContents.length === 3) {
                currentStep = 1.5;
                updateTip('ææ–™å·²é½å…¨ï¼Œç‚¹å‡»é”…å¼€å§‹ç…®ç²‰æ¡ï¼');
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆé€»è¾‘
        function initGameLogic() {
            // æŒ‰é’®ç‚¹å‡»äº‹ä»¶ - ä½¿ç”¨ click äº‹ä»¶ï¼Œå®ƒåœ¨è§¦æ‘¸è®¾å¤‡ä¸Šä¼šè‡ªåŠ¨è§¦å‘
            document.getElementById('pot').addEventListener('click', handlePotClick);
            document.getElementById('mixBtn').addEventListener('click', handleMix);
            document.getElementById('steamBtn').addEventListener('click', handleSteam);
            document.getElementById('submitQuiz').addEventListener('click', submitQuiz);
            document.getElementById('nextToReward').addEventListener('click', goToReward);

            // ç­”é¢˜é€‰é¡¹
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (document.getElementById('quizResult').classList.contains('show')) return;
                    
                    const questionIndex = this.dataset.index;
                    const answer = this.dataset.answer;
                    
                    document.querySelectorAll(`.quiz-option[data-index="${questionIndex}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    quizAnswers[questionIndex] = answer;
                });
            });
        }

        function handlePotClick() {
            if (currentStep !== 1.5) return;
            
            updateTip('ç…®ç²‰æ¡ä¸­...');
            currentStep = 1.6;
            
            setTimeout(() => {
                document.getElementById('potZone').innerHTML = '';
                addEmojiToZone('leftZone', 'ğŸœ');
                leftBasinContents.push('çº¢è–¯ç²‰æ¡');
                
                ['çŒªè‚‰', 'ç‰›è‚‰', 'ç¾Šè‚‰'].forEach(m => {
                    document.querySelector(`[data-material="${m}"]`).style.display = 'flex';
                });
                
                currentStep = 2;
                updateTip('æ‹–æ‹½ä¸€ç§è‚‰ç±»åˆ°å³ç›†ï¼ˆçŒªè‚‰/ç‰›è‚‰/ç¾Šè‚‰ä¸‰é€‰ä¸€ï¼‰');
            }, 2000);
        }

        function handleMix() {
            if (currentStep !== 4) return;
            
            document.getElementById('mixBtn').style.display = 'none';
            document.querySelector('.cooking-area').style.display = 'none';
            document.getElementById('mixingArea').style.display = 'block';
            
            const mixedContent = document.getElementById('mixedContent');
            let mixEmojis = '';
            
            leftBasinContents.forEach(item => {
                if (item === 'çº¢è–¯ç²‰æ¡') mixEmojis += 'ğŸœ';
            });
            rightBasinContents.forEach(item => {
                if (item === 'çŒªè‚‰') mixEmojis += 'ğŸ·';
                else if (item === 'ç‰›è‚‰') mixEmojis += 'ğŸ„';
                else if (item === 'ç¾Šè‚‰') mixEmojis += 'ğŸ‘';
                else if (item === 'ç‰ç±³é¢') mixEmojis += 'ğŸŒ½';
                else if (item === 'ç™½é¢') mixEmojis += 'ğŸš';
            });
            
            mixedContent.innerHTML = `
                <div style="font-size: 40px; margin-bottom: 10px;">${mixEmojis}</div>
                <div>æ­£åœ¨æ··åˆæ…æ‹Œ...</div>
                <div style="font-size: 12px; color: #999; margin-top: 5px;">
                    å·¦ç›†ç²‰æ¡ + å³ç›†${selectedMeat}å’Œé¢ç²‰
                </div>
            `;
            
            updateTip('æ··åˆæ…æ‹Œå®Œæˆï¼');
            
            setTimeout(() => {
                updateTip('å‡†å¤‡è’¸åˆ¶ï¼Œç‚¹å‡»å¼€å§‹ï¼');
                document.getElementById('steamBtn').style.display = 'block';
                currentStep = 5;
            }, 2000);
        }

        function handleSteam() {
            if (currentStep !== 5) return;
            
            document.getElementById('mixingArea').innerHTML = `
                <div class="mixed-content">
                    <div style="font-size: 50px;">â™¨ï¸</div>
                    <div>è’¸åˆ¶ä¸­ï¼Œè¯·ç¨å€™...</div>
                </div>
            `;
            updateTip('è’¸åˆ¶éœ€è¦60åˆ†é’Ÿ...');
            
            setTimeout(() => {
                document.getElementById('cookingScreen').classList.remove('active');
                document.getElementById('quizScreen').classList.add('active');
            }, 6000);
        }

        // æ­£ç¡®ç­”æ¡ˆé…ç½®
        const correctAnswers = {
            1: 'A',
            2: 'B',
            3: 'C'
        };

        const answerExplanations = {
            1: 'åˆ¶ä½œè’¸è‚‰æ—¶ï¼Œç¡®å®éœ€è¦ç›ã€åä¸‰é¦™ã€è€æŠ½ã€ç”œé¢é…±ã€èšæ²¹ç­‰è°ƒæ–™æ¥è…Œåˆ¶è‚‰ç‰‡å’Œç²‰æ¡ï¼Œè¿™äº›è°ƒæ–™èƒ½å¤Ÿè®©è’¸è‚‰æ›´åŠ å…¥å‘³ã€‚',
            2: 'æ´›å®è’¸è‚‰çš„æ ¸å¿ƒçƒ¹é¥ªæ–¹å¼æ˜¯"è’¸"ï¼Œè¿™ä¹Ÿæ˜¯å®ƒåå­—çš„ç”±æ¥ã€‚é€šè¿‡è’¸æ±½åŠ çƒ­ï¼Œèƒ½å¤Ÿæœ€å¤§ç¨‹åº¦ä¿ç•™é£Ÿæçš„è¥å…»å’Œå£æ„Ÿã€‚',
            3: 'æ´›å®è’¸è‚‰ä½œä¸ºéç‰©è´¨æ–‡åŒ–é—äº§ï¼Œæœ€é‡è¦çš„ä»·å€¼åœ¨äºå®ƒæ‰¿è½½äº†æ´›å®åœ°åŒºçš„å†å²è®°å¿†ã€ç”Ÿæ´»æ™ºæ…§ä¸å®¶æ—æƒ…æ„Ÿï¼Œæ˜¯å½“åœ°æ–‡åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚'
        };

        function submitQuiz() {
            if (Object.keys(quizAnswers).length < 3) {
                alert('è¯·å›ç­”æ‰€æœ‰3é“é¢˜ç›®ï¼');
                return;
            }

            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });

            document.getElementById('submitQuiz').style.display = 'none';

            const resultContent = document.getElementById('resultContent');
            let correctCount = 0;
            let resultHTML = '';

            for (let i = 1; i <= 3; i++) {
                const userAnswer = quizAnswers[i];
                const correctAnswer = correctAnswers[i];
                const isCorrect = userAnswer === correctAnswer;
                
                if (isCorrect) correctCount++;

                const questionTitle = document.querySelector(`[data-question="${i}"] .question-title`).textContent;
                
                resultHTML += `
                    <div class="result-item ${isCorrect ? 'correct' : 'wrong'}">
                        <div class="result-question">${questionTitle}</div>
                        <div class="result-answer">
                            æ‚¨çš„ç­”æ¡ˆï¼š${userAnswer} ${isCorrect ? 'âœ“' : 'âœ—'}<br>
                            <span class="result-correct-answer">æ­£ç¡®ç­”æ¡ˆï¼š${correctAnswer}</span><br>
                            <span style="color: #666; font-size: 13px; margin-top: 5px; display: block;">${answerExplanations[i]}</span>
                        </div>
                    </div>
                `;

                document.querySelectorAll(`.quiz-option[data-index="${i}"]`).forEach(opt => {
                    const optAnswer = opt.dataset.answer;
                    if (optAnswer === correctAnswer) {
                        opt.classList.add('correct-answer');
                    } else if (optAnswer === userAnswer && !isCorrect) {
                        opt.classList.add('wrong-answer');
                    }
                });
            }

            resultHTML = `<div style="text-align: center; margin-bottom: 15px; font-size: 18px; font-weight: bold; color: ${correctCount === 3 ? '#4CAF50' : '#FF6B6B'};">ç­”å¯¹ ${correctCount}/3 é¢˜</div>` + resultHTML;
            
            resultContent.innerHTML = resultHTML;
            document.getElementById('quizResult').style.display = 'block';
            
            if (navigator.vibrate && correctCount === 3) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        function goToReward() {
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('rewardScreen').classList.add('active');
        }
    </script>
</body>
</html>
